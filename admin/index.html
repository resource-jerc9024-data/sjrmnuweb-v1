<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Login SJR MNU </title>
  <link rel="stylesheet" href="../handler/styles.css" />
  <link rel="icon" type="image/x-icon" href="../favicon.ico" />
  <style>
    body { min-height:100vh; background: radial-gradient(1200px 600px at 20% -10%, #7c3aed22, transparent), radial-gradient(1000px 500px at 120% 10%, #06b6d422, transparent), linear-gradient(180deg, #0b1020, #0f172a); color:#e5e7eb; }
    .auth-shell { display:grid; place-items:center; min-height:auto; padding:24px; }
    .auth-card { width:100%; max-width:440px; background:rgba(17, 24, 39, 0.7); backdrop-filter: blur(8px); border:1px solid #1f2937; border-radius:16px; box-shadow: 0 20px 60px rgba(0,0,0,.45); padding:28px; }
    .brand { display:flex; align-items:center; gap:10px; margin-bottom:16px; }
    .brand .logo { width:64px; height:64px; border-radius:12px; object-fit:cover; background:#fff; box-shadow: 0 10px 28px rgba(158,240,26,.20); }
    .brand h1 { font-size:20px; margin:0; color:#f8fafc; letter-spacing:.3px; }
    .subtitle { color:#9ca3af; margin:0 0 16px 0; font-size:13px; }
    .form .field span { color:#cbd5e1; }
    .form input { background:#0b1220; border:1px solid #1f2937; color:#e5e7eb; border-radius:10px; padding:12px 12px; outline:none; transition:.2s border-color, .2s box-shadow; }
    .form input:focus { border-color:#6366f1; box-shadow:0 0 0 4px #6366f11f; }
    .actions { gap:10px; }
    .btn.primary { background:linear-gradient(135deg, var(--primary, #9ef01a), var(--primary-strong, #b9ff2b)); border:none; box-shadow:0 10px 24px rgba(158,240,26,.18); color:#0b1220; font-weight:600; }
    .btn.ghost { border-color:#334155; color:#cbd5e1; }
    .btn.google { display:flex; align-items:center; justify-content:center; gap:8px; width:100%; background:#111827; border:1px solid #1f2937; color:#e5e7eb; }
    .btn.google:hover { border-color:#334155; }
    .divider { display:flex; align-items:center; gap:12px; color:#94a3b8; font-size:12px; margin:16px 0; }
    .divider::before, .divider::after { content:""; height:1px; background:#1f2937; flex:1; }
    .footnote { color:#94a3b8; text-align:center; font-size:12px; margin-top:6px; }
  </style>
</head>
<body>
  <div class="auth-shell">
    <div class="auth-card">
      <div class="brand">
        <img class="logo" src="../images/logo.png" alt="SJR MUN" />
        <h1>Admin Access</h1>
      </div>
      <p class="subtitle">Sign in to manage registrations</p>
      <form id="emailLoginForm" class="form" novalidate>
        <div class="grid">
          <label class="field">
            <span>Email</span>
            <input type="email" name="email" placeholder="you@example.com" required />
          </label>
          <label class="field">
            <span>Password</span>
            <input type="password" name="password" placeholder="••••••••" required />
          </label>
        </div>
        <div class="actions">
          <button type="submit" class="btn primary" style="flex:1;">Login</button>
          <button type="button" id="resetPasswordBtn" class="btn ghost">Forgot Password</button>
        </div>
      </form>

      <div class="divider">Or continue with</div>
      <div class="actions" style="justify-content:center;">
        <button id="googleLoginBtn" class="btn google">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 48 48" aria-hidden="true"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24 s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657 C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.335,6.306,14.691z"/><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.277-7.946l-6.536,5.036C9.49,39.556,16.227,44,24,44z"/><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-3.977,5.571 c0.001-0.001,0.001-0.001,0.002-0.002l6.19,5.238C36.955,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/></svg>
          Sign in with Google
        </button>
      </div>
      <p class="footnote">Don't have an account? Contact administrator.</p>
    </div>
  </div>

  <footer class="footer elevated" style="--footer-margin-top:120px; --footer-margin-bottom:80px; --footer-padding-bottom:22px;">
    <small>Designed for SJR MUN CLUB</small>
    <br />
    <span class="footer-credits">Website by <strong><a class="credit-link" href="https://works.onpratiks.com" target="_blank" rel="noopener noreferrer">Pratik</a></strong> &copy; <span id="currentYear"></span></span>
    <div class="footer-bar">
      <div class="left">
        <a class="social-btn" href="https://www.instagram.com/sjrmun" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11zm0 2a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7zm5.75-.75a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0z"/>
          </svg>
          <span>Instagram</span>
        </a>
      </div>
      <div class="right" style="display:flex; gap:12px; align-items:center;">
        <a class="social-btn admin" href="../" aria-label="Home" style="background:transparent; border:1px solid var(--primary); color:var(--primary); box-shadow:none;">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false"><path fill="currentColor" d="M3 9.5 12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V9.5z"/></svg>
          <span>Home</span>
        </a>
        <a class="social-btn admin" href="../formview" aria-label="Form View">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false"><path fill="currentColor" d="M6 2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm7 1.5V8h4.5L13 3.5zM8 11h8v1.5H8V11zm0 3h8v1.5H8V14zm0 3h5v1.5H8V17z"/></svg>
          <span>Form View</span>
        </a>
      </div>
    </div>
  </footer>

  <script>
    (function(){
      const y = document.getElementById('currentYear');
      if (y) y.textContent = new Date().getFullYear();
      const fc = document.querySelector('.footer-credits');
      if (fc) fc.style.transform = 'translateY(-2px)';
    })();
  </script>
  <script>
    window.loadFirebaseConfig = async function loadFirebaseConfig(){
      try {
        if (window.FIREBASE_API_KEY && window.FIREBASE_PROJECT_ID) return true;
        const res = await fetch('/api/env');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const cfg = await res.json();
        if (!cfg.FIREBASE_API_KEY || !cfg.FIREBASE_PROJECT_ID) throw new Error('Missing required Firebase configuration');
        window.FIREBASE_API_KEY = cfg.FIREBASE_API_KEY;
        window.FIREBASE_AUTH_DOMAIN = cfg.FIREBASE_AUTH_DOMAIN;
        window.FIREBASE_PROJECT_ID = cfg.FIREBASE_PROJECT_ID;
        window.FIREBASE_STORAGE_BUCKET = cfg.FIREBASE_STORAGE_BUCKET;
        window.FIREBASE_MESSAGING_SENDER_ID = cfg.FIREBASE_MESSAGING_SENDER_ID;
        window.FIREBASE_APP_ID = cfg.FIREBASE_APP_ID;
        return true;
      } catch (err) {
        console.error('Failed to load Firebase config:', err);
        showToast('Application configuration error. Please contact administrator.', 'error');
        return false;
      }
    }
  </script>
  <script>
    (function(){
      function ensureToast(){
        let el = document.getElementById('popup');
        if (!el) {
          el = document.createElement('div');
          el.id = 'popup';
          el.className = 'toast';
          el.innerHTML = '<span id="popupText"></span><button id="popupClose" class="btn ghost">Close</button>';
          document.body.appendChild(el);
          const close = el.querySelector('#popupClose');
          close.addEventListener('click', () => { el.classList.remove('show','success','error'); });
        }
        return el;
      }
      window.showToast = function(msg, kind='success'){
        const el = ensureToast();
        const text = el.querySelector('#popupText');
        if (text) text.textContent = msg;
        el.classList.remove('success','error');
        el.classList.add('show', kind);
        clearTimeout(el.__hideT);
        el.__hideT = setTimeout(() => el.classList.remove('show','success','error'), 6000);
      }
    })();
  </script>
  <script>
    window.env = {
      FIREBASE_API_KEY: window.FIREBASE_API_KEY || "",
      FIREBASE_AUTH_DOMAIN: window.FIREBASE_AUTH_DOMAIN || "",
      FIREBASE_PROJECT_ID: window.FIREBASE_PROJECT_ID || "",
      FIREBASE_STORAGE_BUCKET: window.FIREBASE_STORAGE_BUCKET || "",
      FIREBASE_MESSAGING_SENDER_ID: window.FIREBASE_MESSAGING_SENDER_ID || "",
      FIREBASE_APP_ID: window.FIREBASE_APP_ID || ""
    };
  </script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

    const ok = await window.loadFirebaseConfig();
    if (!ok) throw new Error('Firebase configuration failed to load');
    const cfg = {
      apiKey: window.FIREBASE_API_KEY,
      authDomain: window.FIREBASE_AUTH_DOMAIN,
      projectId: window.FIREBASE_PROJECT_ID,
      storageBucket: window.FIREBASE_STORAGE_BUCKET,
      messagingSenderId: window.FIREBASE_MESSAGING_SENDER_ID,
      appId: window.FIREBASE_APP_ID,
    };
    const app = initializeApp(cfg);
    const auth = getAuth(app);

    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = 'admin/panel';
      }
    });

    const form = document.getElementById('emailLoginForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const email = fd.get('email');
      const password = fd.get('password');
      try {
        await signInWithEmailAndPassword(auth, email, password);
        window.location.href = 'admin/panel';
      } catch (err) {
        showToast('Login failed. Please check your credentials.', 'error');
        console.error(err);
      }
    });

    document.getElementById('resetPasswordBtn').addEventListener('click', async () => {
      const email = (new FormData(form)).get('email');
      if (!email) {
        showToast('Enter your email first.', 'error');
        return;
      }
      try {
        await sendPasswordResetEmail(auth, email);
        showToast('Password reset email sent.', 'success');
      } catch (err) {
        showToast('Failed to send reset email.', 'error');
        console.error(err);
      }
    });

    document.getElementById('googleLoginBtn').addEventListener('click', async () => {
      const provider = new GoogleAuthProvider();
      try {
        await signInWithPopup(auth, provider);
        window.location.href = 'admin/panel';
      } catch (err) {
        showToast('Google login failed.', 'error');
        console.error(err);
      }
    });
  </script>
</body>
</html>
